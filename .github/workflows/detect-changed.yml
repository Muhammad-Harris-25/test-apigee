name: Apigee - Detect Changed Proxies

on:
  push:
    branches: [ dev, uat, prod ]
    paths-ignore:
      - README.md
      - shared-pom.xml
      - apigeelint-pr.yml
      - azure-pipelines.yml
      - scripts/**

jobs:
  detect:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Detect changed proxies
        shell: bash
        run: |
          BASE=$(git rev-parse HEAD~1 2>/dev/null || git rev-list --max-parents=0 HEAD)

          CHANGED=$(git diff --name-only $BASE HEAD \
            | grep '^api-proxies/' \
            | cut -d'/' -f2 \
            | sort -u)

          echo ""
          echo "======================================"
          echo "üîç DETECTED APIGEE PROXIES"
          echo "======================================"

          if [ -z "$CHANGED" ]; then
            echo "‚ùå No proxy changes detected"
            exit 0
          fi

          for p in $CHANGED; do
            echo "üëâ $p"
          done

          echo ""
          echo "‚û°Ô∏è Copy proxy names and run:"
          echo "‚û°Ô∏è Apigee - Manual Deploy workflow"
